<div class="container" fxLayout="row" fxLayoutAlign="center none">
  <div fxFlex="100%">
    <mat-card style="display: flex; flex-direction: column; gap: 1rem">
      <mat-card-content>
        <h1>Upload</h1>
        <div class="file-drop-area-wrap">
          <div *ngIf="uploading" class="loading-overlay">
            <mat-spinner class="loader" diameter="60"></mat-spinner>
          </div>
          <ngx-file-drop class="file-drop-area"
            [class.file-drop-area_disabled]="uploading"
            (onFileDrop)="dropped($event)"
            accept=".png,.jpeg,.jpg,.webp"
            dropZoneLabel="Drop images here">
            <ng-template let-openFileSelector="openFileSelector" ngx-file-drop-content-tmp>
              Drop images here (or pick
              <button (click)="openFileSelector()" mat-icon-button type="button">
                <mat-icon>folder_open</mat-icon>
              </button>
              )
            </ng-template>
          </ngx-file-drop>
        </div>
      </mat-card-content>
      <div class="actions">
        <button (click)="onUploadClick()" [disabled]="waitUpload() == 0 || uploading"
                color="primary"
                mat-raised-button
                style="flex-grow: 80">Upload
        </button>
        <button (click)="onClearClick()" [disabled]="files.length == 0 || uploading"
                color="warn"
                mat-raised-button
                style="flex-grow: 20">Clear
        </button>
      </div>
      <div class="preview-cards-container">
        <mat-card *ngFor="let file of files"
                  [ngClass]="'upload-image-preview-card_' + file.uploaded"
                  class="upload-image-preview-card">
          <div *ngIf="file.uploaded == 'error'" class="error-message">
            {{file.uploadingError}}
          </div>
          <div class="image-container">
            <img [src]="file.objectUrl">
          </div>


          <div class="props-container">
            <div class="prop-container">
              <div class="prop-name">File name</div>
              <div class="prop-value-container">
                <mat-icon>file_present</mat-icon>
                <div class="prop-value">{{file.name}}</div>
              </div>
            </div>
            <div class="prop-container">
              <div class="prop-name">Size</div>
              <div class="prop-value-container">
                <mat-icon>save</mat-icon>
                <div class="prop-value">{{file.sizeHuman}}</div>
              </div>
            </div>
            <div *ngIf="!isAuthenticated" class="prop-container">
              <div class="prop-name">Master code</div>
              <div class="prop-value-container">
                <mat-icon>save</mat-icon>
                <div class="prop-value">{{file.uploadedFile?.manageToken ?? 'Fill after upload'}}</div>
              </div>
            </div>
            <div class="link-container">
              <span>{{file.uploadedFile?.image?.shortUrl ?? 'Require upload'}}</span>
              <button (click)="onCopyShortLinkClick(file)"
                      [disabled]="file.uploadedFile?.image?.shortUrl == null"
                      mat-icon-button>
                <mat-icon>content_copy</mat-icon>
              </button>
            </div>
          </div>

        </mat-card>
      </div>
    </mat-card>
  </div>
</div>
